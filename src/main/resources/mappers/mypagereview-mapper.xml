<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.kh.laf.mypage.model.mapper.MypageReviewMapper">

	
	<!-- myReviewList -->
     <select id="myReview" resultType="Review">
        SELECT DISTINCT  r.review_no, m.member_id, 
        				 r.review_content, 
        				 r.review_create_date, 
        				 r.review_score, 
        				 r.order_no, 
        				 r.product_no, 
        				 r.option_no, 
        				 o.order_uno,
        				 `count`, 
        				 TRUNCATE((SELECT AVG(review_score) FROM review sr WHERE r.product_no =sr.product_no),1) review_score_avg, 
        				 (SELECT COUNT(*) FROM review rc WHERE rc.product_no=r.product_no) review_Count 
        FROM review r LEFT JOIN `order` o ON r.order_no =o.order_no 
        			  LEFT JOIN `member` m ON o.member_no = m.member_no 
        			  LEFT JOIN order_product op ON o.order_no=op.order_no  
        WHERE m.member_no=#{memberNo} AND o.review_no IS null
    </select>
    
	<!-- myReviewOption -->
     <select id="myOrderOption" resultType="Option">
        SELECT * FROM `option` o WHERE option_no=#{optionNo}
    </select>
    
	<!-- myReviewOption -->
     <select id="myOrderProduct" resultType="Product">
        SELECT `product`.product_no,
				product_name,
				product_price,
				product_sale_price,
				product_sale,
				product_point,
				product_state,
				DATE_FORMAT(product_date, '%Y-%m-%d') AS product_date,
				img_path AS thumbnail_path
		FROM   `product`
				JOIN `product_img` ON `product`.product_no = `product_img`.product_no WHERE `product`.product_no=#{productNo}
    </select>
    
    <!-- myReviewList -->
     <select id="myWrittenReview" resultType="Review">
        SELECT DISTINCT  r.review_no, m.member_id, 
        				 r.review_content, 
        				 r.review_create_date, 
        				 r.review_score, 
        				 r.order_no, 
        				 r.product_no, 
        				 r.option_no, 
        				 o.order_uno,
        				 `count`, 
        				 TRUNCATE((SELECT AVG(review_score) FROM review sr WHERE r.product_no =sr.product_no),1) review_score_avg, 
        				 (SELECT COUNT(*) FROM review rc WHERE rc.product_no=r.product_no) review_Count 
        FROM `order` o LEFT JOIN review r ON r.order_no =o.order_no 
        			  LEFT JOIN `member` m ON o.member_no = m.member_no 
        			  LEFT JOIN order_product op ON o.order_no=op.order_no  
        WHERE m.member_no=#{memberNo} AND o.review_no IS NOT null
    </select>
    

</mapper>

